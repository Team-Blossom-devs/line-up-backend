<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" th:href="@{/css/entrance-info-style.css}">
    <title>입장 정보 입력</title>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        const sendData = async (waitingId, tableNumber, tableCount) => {
            if (tableNumber === null || tableCount === null){
                console.log(tableNumber);
                return;
            }

            await axios.patch("http://localhost:8080/api/manager/complete", {
                id: waitingId,
                tableNumber: tableNumber,
                tableCount: tableCount
            })
            .then((response) => {
                console.log(response)
                if (response.data.code === 'COM-000'){
                    window.alert('입장 처리 완료');
                    window.location.href = response.data.data.redirectUrl;
                } else {
                    throw new Error();
                }
            })
            .catch((error) => {
                console.error('Error: ', error);
                window.alert('입장 처리에 실패하였습니다. 운영자에게 문의하세요.');
            })
        }

        function getInputValue(idName) {
            const inputValue = document.getElementById(idName).value;
            if (inputValue === '') {
                window.alert('입력 값이 필요합니다!')
                return null;
            }
            return parseInt(inputValue);
        }
    </script>
    <div id="container">
        <div id="container-head">
            Line-Up 어드민
        </div>
        <div id="container-table-number">
            <span>테이블 번호</span>
            <input type="number" id="table-number-input">
        </div>
        <div id="container-table-count">
            <span>테이블 개수</span>
            <input type="number" id="table-count-input" value="1">
        </div>
        <button id="container-footer" th:attr="data-id=${id}" onclick="sendData(this.getAttribute('data-id'), getInputValue('table-number-input'), getInputValue('table-count-input'))">전송</button>
    </div>
</body>
</html>